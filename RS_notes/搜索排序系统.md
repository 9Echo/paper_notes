# 搜索排序系统

## 核心场景

在每一段时间窗口结束位置，更新所有货源与司机状态，返回当前时间窗口内的这一批司机所匹配的货物列表。

- **输入**：
  - 当前时间结点下的库存数据（Stock_list）
  - 当前时间窗口内的司机信息（Truck）
- **输出**：
  - 当前时间窗口内的司机对应的货物列表（Pack_list)

- **切分时间窗口**：司机在app上点击报道表示准备装货（司机十公里内报道），统计并分析司机报道的时间发现司机报道集中在某一时间段内（主要是上午8点至10点），下午报道司机数量较少，将一天的时间切分为不同粒度的时间窗口。
- **司机特征**：
  - 常运品种
  - 常运路线
  - 常装卸仓库（少装/多装）
  - 司机住址（通过身份证获取）
  - 常装货时间（早中晚）
  - 最近一次装货时间
  - 最近一周/一月装货次数（活跃天数）
  - 常装卸时间差（运货频率）
- **货物特征**：
  - 品种
  - 城市
  - 优先级
  - 装卸仓库
  - 发布信息
  - 车辆信息
- **目标/评价指标**：
  - 预测准确率

1. 离线计算
   - 更新当前平台所有司机的个人信息、历史运载记录
   - 根据历史运输记录挖掘司机偏好，同时为新司机生成
2. 在线平台
   - 根据司机信息和业务规则，对货物进行筛选过滤；
   - 建立匹配模型 $f(s,t)$，其中 $S$ 表示货物集合， $s\in S$ 表示某一具体货物，$T$ 表示司机集合 $t\in T$ 表示某一特定司机；
   - 时间窗口结束时，输入当前筛选的货物和司机
   - 召回当前可用货源对其过滤、排序、然后再召回对应规则（城市、品种）的司机，对司机进行过滤、排序。最终将货源推送给司机。

根据货物特征和司机特征，生成对应的货物特征向量和司机特征向量，对其进行匹配度分析及排序，最终根据排序结果将货物与司机进行匹配。

匹配度计算：根据司机特征，排除不匹配的货物；通过相似度方程计算剩余货物与司机的匹配度，根据每一司机，根据货物匹配度进行排序，生成最终的排序结果。



### BRP算法

在车货匹配问题中，货物的数量远远多过于司机的数量，很多时候我们只能收集到少数正例样本，剩下的数据其实是真实负例和缺失值的混合构成（这里的缺失值是指训练数据中除正例和负例外的未知数据，可以理解为未曝光或者曝光了的但是用户可能没有注意到缺失数据，所以缺失值中的样本即有可能是正例，也有可能是负例），而我们用这种方法构建训练数据的时候，往往无法确定负例到底是哪些，就只能把除正例以外的其他部分都当作是负例，这就会使得训练数据中负例的一部分其实是缺失值。把缺失值当作是负样本，再以预测误差为评判标准去使劲逼近这些样本。逼近正样本没问题，但是同时逼近的负样本只是缺失值而已，真正呈现在用户面前，并不能确定是不喜欢还是喜欢。而且，这样的模型**仅能预测正例或负例，对于类别内的样本无法深入区别其重要性**，不利于排序。
