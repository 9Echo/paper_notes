# 排序学习（Learn to Rank）

### 传统的推荐算法

1. **基于内容的推荐算法**

   - 获取用户的兴趣偏好信息，通过显式（函数）或者隐式（机器学习）的方法对用户建立相似度计算模型，通过计算这个相似度得到用户的推荐结果。
   - 没有用户的反馈信息，新项目不存在冷启动问题，且容易实现

2. **协同过滤推荐算法**

   - **基于用户**
     - 通过计算用户与用户之间的兴趣偏好相似度，找到与目标用户有相似兴趣的其他用户，把其他用户感兴趣的物品推荐给目标用户。
     - 一旦用户数目庞大，用户兴趣相似度矩阵越来越困难，时间复杂度过高，而且难以对推荐结果做出解释。
   - **基于物品**
     - 推荐目标用户历史喜欢的物品相似的物品，主要分析用户的行为记录来计算物品和物品之间的相似度。

3. **混合推荐算法**

   - **组合**基于内容的和协同过滤两种方法，即混合推荐算法。

     - **后融合**（Bagging）

       类似线性组合、投票机制等组合方式组合两种算法的推荐结果。

     - **中融合**（Boosting）

       以一种推荐算法为框架，融合另一种推荐算法（一主一辅）。

     - **前融合**

       融合两种方法为统一的算法框架。

4. 其他

   - **基于知识的推荐算法**

     根据特定领域的规则进行基于规则和实例的推荐，关键在于：规则的获取和推荐、规则知识库的构建。

   - **基于语义相似度分析的推荐算法**

     利用领域本体计算项目之间的相似性，更加形式化地表示

### 背景介绍

 **排序学习**（Learning to Rank）源于信息检索（Information Retrieval），经典的信息检索模型：**布尔模型、向量空间模型、概率模型、语言模型**以及链接分析等。（大多属于无监督学习），利用一些特征进行排序。容易调整经验参数，得到最优的参数，但当场景越来越复杂，人为凭经验优化参数的过程也越来越复杂。

> 比如说已知客户的特征、货物的特征，对客户数据集、货物数据集进行一个函数计算，（可以调整函数的参数）得到一个符合需求的排序结果。想要先发优先级高的货物，就把优先级的权重调大，让优先级高的排在前面。本质上是数学公式计算，数学公式人为定义。

**排序学习定义**：基于机器学习中用于解决分类与回归问题的思想，提出利用机器学习方法解决排序的问题。

排序学习的目标在于自动地从训练数据中学习得到一个排序函数，使其在文本检索中能够针对文本的相关性、重要性等衡量标准对文本进行排序。

机器学习的优势是：**整合大量复杂特征并自动进行参数调整，自动学习最优参数，降低了单一考虑排序因素的风险；同时，能够通过众多有效手段规避过拟合问题。**

排序模型**综合考虑各种影响用户偏好的因素**，即推荐系统领域的排序学习。推荐系统领域中常用的三种方法：基于内容、协同推荐、混合推荐

> **论文标题**：*[Toward the Next Generation of Recommender Systems: A Survey of the State-of-the-Art and Possible Extensions](https://link.zhihu.com/?target=https%3A//aminer.cn/pub/53e9a48eb7602d9702daa8d9/toward-the-next-generation-of-recommender-systems-a-survey-of-the-state)*
>
> **作者**：Gediminas Adomavicius, Alexander Tuzhilin
>
> **期刊/会议**：IEEE Trans. Knowl. Data Eng., pp. 734-749, 2005.

基于排序学习的推荐算法通用模型：

<img src="http://xtf615.com/picture/machine-learning/l2r.png">

与推荐算法结合的排序学习广义上来说算是监督学习，训练数据集是已经处理好的交互数据或人为标注好的数据作为训练集进行学习。训练得到的排序模型 $f(u, i)$ 进行排序过程得到排序结果。

从狭义上说，推荐系统更像是无监督学习，因为推荐系统的LTR更强调利用原始交互数据（interaction data）进行排序学习，与之相对应的 IR领域（信息检索）更偏向于人为专家标注的监督数据进行排序学习，更像是监督学习。当然也有例外：IR领域的OLTR(Online Learning to Rank, [SIGIR2016: Slides: Online Learning to Rank for Information Retrieval ](https://staff.fnwi.uva.nl/m.derijke/wp-content/uploads/sigir2016-tutorial.pdf))利用的是交互数据，更接近于推荐系统领域的LTR。

工业界的推荐系统分为两个阶段：**召回阶段和排序阶段**。召回阶段根据用户的兴趣和历史行为，从千万级的物品库选出一个小的候选集（粗略的），这些候选集是用户大概率感兴趣的内容；排序阶段在此基础上进行更精准的计算，为每一个物品进行打分（精确的）。

### 前言

根据输入样例的不同，排序学习大体分为3类：

1. 点级（pointwise）：输入包括用户、物品特征，根据排序的不同方式划分为回归和分类两种方法，本质上将排序问题退化为**回归与分类问题求解**；
2. 对级（pairwise）：考虑物品对之间的偏序关系，将问题转化为**有序分类**问题；
3. 列表级（listwise）：输入所有相关联的物品集合，更加全面地考虑物品的序列关系（近年热门）。

综上，排序学习主要依赖于用户的**数据标注**，用户、物品、搜索、上下文的**特征工程**以及**排序模型**。

#### 数据标注（data labeling）

用户的行为数据主要从用户搜索、系统展示、用户实际的交互操作（反馈）得到。主要也是对应上述三种方式。

- pointwise方式：单个物品对单个用户而言，即为**正负样本**之分。正样本：用户点击、浏览、收藏、下单、支付等，不同的操作反映用户对物品的匹配程度，赋予对应的权重；负样本：可以采取skip above策略，比如同样的物品列表，在用户点过的之上（浏览页面的上下），作为负样本。

  > 正负样本为最简单的二元分类，即相关或者不相关，还可以扩展为多元的相关性判断，比如非常相关、一般相关、相关、不相关等。

- pairwise方式：构造物品pair对，单个用户没有绝对的偏好，只有**相对偏好**（比如比起物品B，用户更喜欢物品A）

  > click > skip above; （某个点击的物品顺序应该排在该物品之前、但用户略过的物品更好）
  >
  > last click > skip above;
  >
  > click > earlier click
  >
  > click > no-click next

- listwise方式：考察列表级别的排序。例如，列表的NDCG指标融入到目标函数中，目标函数能够优化列表级别的排序指标。

#### 特征工程

特征工程涵盖面较广，包括用户特征、物品特征、搜索特征、上下文特征(时间、地点、天气等)等，以及不同特征之间的交叉关联，还包括从其他高阶特征，如使用主题模型提取的用户兴趣分布，使用神经网络提取的高阶特征等等，这些特征都可以作为排序模型的输入。

#### 排序过程

Listwise**模型**的关键要素如下：

- 输入空间：物品集合，$x=\{xj\}_{j=1}^m$
- 输出空间：所有物品的得分或所有物品的完整排序。
- 假设空间：排序函数(permutation function)或得分函数(scoring function)。
- 损失函数：IR评估指标或其平滑近似。

优势：

- 直接优化IR排序指标
- 可以学习物品间listwise层面的属性（如物品之间的依赖性、多样性等）

